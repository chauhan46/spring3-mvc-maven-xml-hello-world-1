node {

    // Parameters
    def branchName = params.BRANCH
    def mvnGoals   = params.MVN_GOALS
    def javaTool   = params.JDK_VER

    stage('Init') {
        echo "Selected Branch: ${branchName}"
        echo "Maven Goals: ${mvnGoals}"
        echo "Java Version: ${javaTool}"

        // Set up Java
        env.JAVA_HOME = tool name: javaTool, type: 'jdk'
        env.PATH = "${env.JAVA_HOME}/bin:${env.PATH}"
        echo "JAVA_HOME = ${env.JAVA_HOME}"
    }

    stage('Checkout') {
        echo "Checking out branch: ${branchName}"
        git url: 'https://github.com/betawins/spring3-mvc-maven-xml-hello-world-1.git',
            branch: "${branchName}"
    }

    stage('Build & Test') {
        echo "Running Maven: ${mvnGoals}"
        sh "mvn ${mvnGoals}"
    }

    stage('Archive Artifacts') {
        echo "Archiving Artifacts"
        archiveArtifacts artifacts: 'target/*.war', fingerprint: true
    }

    stage('Cleanup') {
        cleanWs()
    }
}
