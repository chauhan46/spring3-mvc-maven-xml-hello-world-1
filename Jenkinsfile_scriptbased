node {

    // Environment setup
    stage('Setup ENV') {
        echo "Setting up environment"
        env.JAVA_HOME = tool name: 'JDK8', type: 'jdk'
        env.PATH = "${env.JAVA_HOME}/bin:${env.PATH}"
        echo "JAVA_HOME = ${env.JAVA_HOME}"
    }

    try {

        // Checkout Stage
        stage('Checkout') {
            checkout scm
        }

        // Build Stage
        stage('Build') {
            sh "mvn clean compile"
        }

        // Test Stage
        stage('Test') {
            sh "mvn test"
        }

        // Package Stage
        stage('Package') {
            sh "mvn package"
        }

        // Archive Artifacts
        stage('Archive') {
            archiveArtifacts artifacts: 'target/*.war', fingerprint: true
        }

    } catch (e) {
        currentBuild.result = 'FAILURE'
        throw e
    } finally {
        stage('Cleanup') {
            cleanWs()
        }
    }
}
